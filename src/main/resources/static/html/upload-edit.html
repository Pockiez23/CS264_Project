<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/html/css/upload-edit.css">
</head>
<body>
  <header class="navbar">
        <!-- ‡πÅ‡∏ñ‡∏ö‡∏ö‡∏ô: ‡πÇ‡∏•‡πÇ‡∏Å‡πâ + ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
        <div class="top-bar">
            <div class="logo">
                <img src="/Photo/Sci_TU_Logo_TH-1.png" alt="TU Logo">
            </div>

            <div class="account" id="accountBtn">
                <img src="/Photo/broker-vector-icon.jpg" alt="User">
                <div class="account-info">
                    <span class="name"></span>
                    <span class="id"></span>
                </div>
            </div>

            <!-- Popup -->
            <div class="popup" id="popup">
                <p><span id="popupName"></span><br><small id="popupID"></small></p>
                <button id="logoutBtn">LOGOUT</button>
            </div>
        </div>

        <!-- ‡πÅ‡∏ñ‡∏ö‡∏•‡πà‡∏≤‡∏á: ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å -->
        <nav class="menu-bar">
            <a href="#">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</a>
            <a href="#">‡∏ù‡πà‡∏≤‡∏¢‡∏Ñ‡∏ì‡∏∞‡∏ö‡∏î‡∏µ</a>
            <a href="#">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏Ñ‡∏õ‡∏Å‡∏ï‡∏¥</a>
            <a href="#">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏Ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©</a>
            <a href="#">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø</a>
            <a href="form-list.html">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</a>
            <a href="upload.html">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</a>
        </nav>
    </header>

    <main>
        <a href="home.html" class="back-btn">‚Üê Back to Home</a>

        <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° container ‡∏´‡∏•‡∏±‡∏Å -->
        <div class="edit-container">

            <!-- ‚úÖ ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á preview -->
            <div class="preview-box" id="previewBox">
                <p id="previewText">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</p>
            </div>

            <!-- ‚úÖ ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤: ‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
            <div class="form-area">
                <h2>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</h2>
                <div class="file-meta">
                  <span><strong>‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> <span id="currentFileName">-</span></span>
                  <a id="currentFileLink" class="file-link" href="#" target="_blank" rel="noopener noreferrer">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°</a>
                </div>

                <form id="editPetitionForm" novalidate>
                  <div class="form-field">
                    <label for="petitionDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                    <input type="date" id="petitionDate" name="petitionDate" required>
                  </div>
                  <div class="form-field">
                    <label for="studentName">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="studentName" name="studentName" required>
                  </div>
                  <div class="form-field">
                    <label for="studentId">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                    <input type="text" id="studentId" name="studentId" required>
                  </div>
                  <div class="form-field">
                    <label for="curriculum">‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</label>
                    <input type="text" id="curriculum" name="curriculum" required>
                  </div>
                  <div class="form-field">
                    <label for="major">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</label>
                    <input type="text" id="major" name="major" required>
                  </div>
                  <div class="form-field">
                    <label for="advisorName">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</label>
                    <input type="text" id="advisorName" name="advisorName" required>
                  </div>
                  <div class="form-field">
                    <label for="phoneNumber">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                    <input type="tel" id="phoneNumber" name="phoneNumber" required>
                  </div>
                  <div class="form-field">
                    <label for="email">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <input type="email" id="email" name="email" required>
                  </div>
                  <div class="form-field">
                    <label for="details">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</label>
                    <textarea id="details" name="details" rows="4" required></textarea>
                  </div>
                  <div class="form-field">
                    <label for="fileReplace">‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)</label>
                    <input type="file" id="fileReplace" name="file" accept=".pdf,.png,.jpg,.jpeg">
                    <span id="newFileName" class="file-note">‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°</span>
                  </div>

                  <div class="btn-group">
                    <button type="submit" class="btn btn-send">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</button>
                    <button type="button" id="createNewBtn" class="btn btn-secondary">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                    <button type="button" id="clearBtn" class="btn btn-delete">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                  </div>
                </form>
            </div>
        </div>
    </main>


  <!-- üî∏ Footer -->
    <footer>
        <p>‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ ‡∏°‡∏ò. ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏±‡∏á‡∏™‡∏¥‡∏ï ‡∏ä‡∏±‡πâ‡∏ô 3 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏£‡∏ß‡∏° 5<br>
        ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 99 ‡∏´‡∏°‡∏π‡πà 18 ‡∏ñ‡∏ô‡∏ô‡∏û‡∏´‡∏•‡πÇ‡∏¢‡∏ò‡∏¥‡∏ô ‡∏ï.‡∏Ñ‡∏•‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á ‡∏≠.‡∏Ñ‡∏•‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á ‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ 12120<br>
        ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå : 0-2564-4440-79 ‡∏ï‡πà‡∏≠ 2010</p>
        <p>Email: <a href="mailto:SCITECH.THAMMASAT@GMAIL.COM">scitech.thammasat@gmail.com</a> |
           Facebook: <a href="https://www.facebook.com/ScienceThammasat/" target="_blank" rel="noopener noreferrer">Science and
Technology Thammasat Official</a></p>
    </footer>
        <script src="auth.js"></script>
        <script>
          // ‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
          const session = requireAuth("login.html");
          let petitionId = null;
          let lastLoadedData = null;

          document.addEventListener("DOMContentLoaded", async () => {
            fillUserHeader();
            setupPopup();
            await loadPetition();
          });

          async function loadPetition() {
            const params = new URLSearchParams(window.location.search);
            petitionId = params.get("id") || localStorage.getItem("lastCreatedPetitionId");
            if (!petitionId) {
              alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç");
              window.location.href = "upload.html";
              return;
            }
            try {
              const response = await fetch(`/api/petitions/${petitionId}`);
              if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
              }
              const data = await response.json();
              lastLoadedData = data;
              applyDataToForm(data);
            } catch (error) {
              console.error(error);
              alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ");
            }
          }

          function applyDataToForm(data) {
            document.getElementById("petitionDate").value = data.petitionDate || new Date().toISOString().split("T")[0];
            document.getElementById("studentName").value = data.studentName || session.name || "";
            document.getElementById("studentId").value = data.studentId || session.student_id || "";
            document.getElementById("curriculum").value = data.curriculum || "";
            document.getElementById("major").value = data.major || "";
            document.getElementById("advisorName").value = data.advisorName || "";
            document.getElementById("phoneNumber").value = data.phoneNumber || "";
            document.getElementById("email").value = data.email || session.email || "";
            document.getElementById("details").value = data.details || "";

            document.getElementById("studentName").readOnly = true;
            document.getElementById("studentId").readOnly = true;

            const currentFileName = document.getElementById("currentFileName");
            const currentFileLink = document.getElementById("currentFileLink");
            if (data.fileName) {
              currentFileName.textContent = data.fileName;
            } else {
              currentFileName.textContent = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö";
            }
            if (data.filePath) {
              currentFileLink.href = `/uploads/${data.filePath}`;
              currentFileLink.style.display = "inline";
            } else {
              currentFileLink.removeAttribute("href");
              currentFileLink.style.display = "none";
            }
            updatePreview(data.filePath, data.fileName);
            document.getElementById("fileReplace").value = "";
            document.getElementById("newFileName").textContent = "‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°";
          }

          function updatePreview(filePath, fileName) {
            const previewBox = document.getElementById("previewBox");
            const previewText = document.getElementById("previewText");
            previewBox.innerHTML = "";
            if (!filePath) {
              previewText.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö";
              previewBox.appendChild(previewText);
              return;
            }
            const extension = (fileName || "").split(".").pop().toLowerCase();
            if (["png", "jpg", "jpeg"].includes(extension)) {
              const img = document.createElement("img");
              img.src = `/uploads/${filePath}`;
              img.alt = fileName || "Preview";
              img.classList.add("preview-image");
              previewBox.appendChild(img);
            } else {
              const icon = document.createElement("img");
              icon.src = "https://cdn-icons-png.flaticon.com/512/337/337946.png";
              icon.alt = "PDF";
              icon.classList.add("preview-pdf");
              previewBox.appendChild(icon);
            }
            const label = document.createElement("p");
            label.textContent = fileName || "‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á";
            previewBox.appendChild(label);
            previewText.textContent = "‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
            previewBox.appendChild(previewText);
          }

          document.getElementById("fileReplace").addEventListener("change", handleNewFile);
          document.getElementById("previewBox").addEventListener("click", () => {
            document.getElementById("fileReplace").click();
          });

          function handleNewFile(event) {
            const file = event.target.files[0];
            const newFileLabel = document.getElementById("newFileName");
            if (!file) {
              newFileLabel.textContent = "‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°";
              if (lastLoadedData) {
                updatePreview(lastLoadedData.filePath, lastLoadedData.fileName);
              }
              return;
            }
            const validTypes = ["application/pdf", "image/png", "image/jpeg"];
            if (!validTypes.includes(file.type)) {
              alert("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå PDF, PNG ‡∏´‡∏£‡∏∑‡∏≠ JPG ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
              event.target.value = "";
              newFileLabel.textContent = "‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°";
              if (lastLoadedData) {
                updatePreview(lastLoadedData.filePath, lastLoadedData.fileName);
              }
              return;
            }
            if (file.size > 10 * 1024 * 1024) {
              alert("‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 MB");
              event.target.value = "";
              newFileLabel.textContent = "‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°";
              if (lastLoadedData) {
                updatePreview(lastLoadedData.filePath, lastLoadedData.fileName);
              }
              return;
            }
            newFileLabel.textContent = file.name;
            const previewBox = document.getElementById("previewBox");
            const previewText = document.getElementById("previewText");
            previewBox.innerHTML = "";
            if (file.type === "application/pdf") {
              const icon = document.createElement("img");
              icon.src = "https://cdn-icons-png.flaticon.com/512/337/337946.png";
              icon.alt = "PDF";
              icon.classList.add("preview-pdf");
              previewBox.appendChild(icon);
            } else {
              const img = document.createElement("img");
              img.classList.add("preview-image");
              img.alt = "Preview";
              img.src = URL.createObjectURL(file);
              previewBox.appendChild(img);
            }
            const label = document.createElement("p");
            label.textContent = file.name;
            previewBox.appendChild(label);
            previewText.textContent = "‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
            previewBox.appendChild(previewText);
          }

          document.getElementById("editPetitionForm").addEventListener("submit", async (event) => {
            event.preventDefault();
            const form = event.target;
            if (!form.checkValidity()) {
              form.reportValidity();
              return;
            }
            if (!petitionId) {
              alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á");
              return;
            }
            const formData = new FormData(form);
            try {
              const response = await fetch(`/api/petitions/${petitionId}`, {
                method: "PUT",
                body: formData
              });
              if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
              }
              const updated = await response.json();
              lastLoadedData = updated;
              alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
              applyDataToForm(updated);
            } catch (error) {
              console.error(error);
              alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ");
            }
          });

          document.getElementById("createNewBtn").addEventListener("click", () => {
            window.location.href = "upload.html";
          });

          document.getElementById("clearBtn").addEventListener("click", () => {
            if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
              localStorage.removeItem("lastCreatedPetitionId");
              window.location.href = "upload.html";
            }
          });

          function setupPopup() {
            const popupName = document.getElementById("popupName");
            const popupID = document.getElementById("popupID");
            if (popupName) popupName.textContent = session.name || "";
            if (popupID) popupID.textContent = session.student_id || "";
            const accountBtn = document.getElementById("accountBtn");
            const popup = document.getElementById("popup");
            if (!accountBtn || !popup) {
              return;
            }
            accountBtn.addEventListener("click", () => popup.classList.toggle("show"));
            document.addEventListener("click", e => {
              if (!accountBtn.contains(e.target) && !popup.contains(e.target)) {
                popup.classList.remove("show");
              }
            });
            document.getElementById("logoutBtn")?.addEventListener("click", () => {
              if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) logout("login.html");
            });
          }
        </script>
</body>
</html>
