<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/html/css/upload-edit.css">
</head>
<body>
  <header class="navbar">
        <!-- ‡πÅ‡∏ñ‡∏ö‡∏ö‡∏ô: ‡πÇ‡∏•‡πÇ‡∏Å‡πâ + ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
        <div class="top-bar">
            <div class="logo">
                <img src="/Photo/Sci_TU_Logo_TH-1.png" alt="TU Logo">
            </div>

            <div class="account" id="accountBtn">
                <img src="/Photo/broker-vector-icon.jpg" alt="User">
                <div class="account-info">
                    <span class="name"></span>
                    <span class="id"></span>
                </div>
            </div>

            <!-- Popup -->
            <div class="popup" id="popup">
                <p><span id="popupName"></span><br><small id="popupID"></small></p>
                <button id="logoutBtn">LOGOUT</button>
            </div>
        </div>

        <!-- ‡πÅ‡∏ñ‡∏ö‡∏•‡πà‡∏≤‡∏á: ‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å -->
        <nav class="menu-bar">
            <a href="#">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</a>
            <a href="#">‡∏ù‡πà‡∏≤‡∏¢‡∏Ñ‡∏ì‡∏∞‡∏ö‡∏î‡∏µ</a>
            <a href="#">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏Ñ‡∏õ‡∏Å‡∏ï‡∏¥</a>
            <a href="#">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏Ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©</a>
            <a href="#">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Ø</a>
            <a href="form-list.html">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</a>
            <a href="upload.html">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</a>
        </nav>
    </header>

    <main>
        <a href="home.html" class="back-btn">‚Üê Back to Home</a>

        <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° container ‡∏´‡∏•‡∏±‡∏Å -->
        <div class="edit-container">

            <!-- ‚úÖ ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢: ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á preview -->
            <div class="preview-box" id="previewBox">
                <p id="previewText">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</p>
            </div>

            <!-- ‚úÖ ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤: ‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
            <div class="form-area">
                <p><strong>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:</strong> <span id="fileName"></span></p>
                <p><strong>‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤:</strong>
                <input type="text" id="advisor" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤">
                </p>

                <div class="btn-group">
                    <button id="sendBtn" class="btn btn-send">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</button>
                    <button id="deleteBtn" class="btn btn-delete">‡∏•‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</button>
                </div>
            </div>
        </div>
    </main>


  <!-- üî∏ Footer -->
    <footer>
        <p>‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ ‡∏°‡∏ò. ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏±‡∏á‡∏™‡∏¥‡∏ï ‡∏ä‡∏±‡πâ‡∏ô 3 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏£‡∏ß‡∏° 5<br>
        ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 99 ‡∏´‡∏°‡∏π‡πà 18 ‡∏ñ‡∏ô‡∏ô‡∏û‡∏´‡∏•‡πÇ‡∏¢‡∏ò‡∏¥‡∏ô ‡∏ï.‡∏Ñ‡∏•‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á ‡∏≠.‡∏Ñ‡∏•‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á ‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ 12120<br>
        ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå : 0-2564-4440-79 ‡∏ï‡πà‡∏≠ 2010</p>
        <p>Email: <a href="mailto:SCITECH.THAMMASAT@GMAIL.COM">scitech.thammasat@gmail.com</a> |
           Facebook: <a href="https://www.facebook.com/ScienceThammasat/" target="_blank" rel="noopener noreferrer">Science and Technology Thammasat Official</a></p>
    </footer>
    <script src="auth.js"></script>
    <script>
        // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô
        const session = requireAuth("login.html");

        // (‡∏≠‡∏≠‡∏õ‡∏ä‡∏±‡∏ô) ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠-‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡πÄ‡∏ß‡πá‡∏ö
        document.addEventListener("DOMContentLoaded", () => {
            fillUserHeader(); // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤
        });
    </script>
	<script>
	  // =============== Popup Profile ===============
	  const accountBtn = document.getElementById('accountBtn');
	  const popup = document.getElementById('popup');

	  accountBtn.addEventListener('click', () => {
	      popup.classList.toggle('show');
	  });

	  document.addEventListener('click', (e) => {
	      if (!accountBtn.contains(e.target) && !popup.contains(e.target)) {
	          popup.classList.remove('show');
	      }
	  });

	  document.getElementById('logoutBtn').addEventListener('click', () => {
	      alert("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
	      localStorage.removeItem("auth_session");
	      window.location.href = "login.html";
	  });

	  // =============== ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ upload.html ===============
	  const uploadedFileName = localStorage.getItem("uploadedFileName");
	  const uploadedFilePreview = localStorage.getItem("uploadedFilePreview");
	  const fileNameSpan = document.getElementById("fileName");
	  const previewBox = document.getElementById("previewBox");

	  if (!uploadedFileName) {
	      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ");
	      window.location.href = "upload.html";
	  } else {
	      fileNameSpan.textContent = uploadedFileName;

	      const ext = uploadedFileName.split('.').pop().toLowerCase();
	      previewBox.innerHTML = "";

	      if (ext === "png" || ext === "jpg" || ext === "jpeg") {
	          const img = document.createElement("img");
	          img.src = uploadedFilePreview || "";
	          img.alt = "Preview";
	          img.classList.add("preview-image");
	          previewBox.appendChild(img);
	      } else {
	          previewBox.innerHTML = '<img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" alt="PDF" class="preview-pdf">';
	      }
	  }

	  // =============== ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å Preview ===============
	  previewBox.addEventListener("click", () => {
	      const newFile = document.createElement("input");
	      newFile.type = "file";
	      newFile.accept = ".pdf,.png,.jpg,.jpeg";
	      newFile.click();

	      newFile.addEventListener("change", () => {
	          const file = newFile.files[0];
	          if (!file) return;

	          const validTypes = ["application/pdf", "image/png", "image/jpeg"];
	          if (!validTypes.includes(file.type)) {
	              alert("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå PDF, PNG, ‡∏´‡∏£‡∏∑‡∏≠ JPG ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");
	              return;
	          }

	          localStorage.setItem("uploadedFileName", file.name);
	          if (file.type.startsWith("image/")) {
	              const reader = new FileReader();
	              reader.onload = () => {
	                  localStorage.setItem("uploadedFilePreview", reader.result);
	                  location.reload();
	              };
	              reader.readAsDataURL(file);
	          } else {
	              localStorage.removeItem("uploadedFilePreview");
	              location.reload();
	          }
	      });
	  });

	  // =============== ‡∏õ‡∏∏‡πà‡∏° "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á" ===============
	  document.getElementById("sendBtn").addEventListener("click", async () => {
	      if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;

	      const user = JSON.parse(localStorage.getItem("auth_session") || "{}");
	      const advisorName = document.getElementById("advisor").value.trim();

	      if (!advisorName) {
	          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤");
	          return;
	      }

	      const petition = {
	          studentId: user.studentId || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏£‡∏´‡∏±‡∏™",
	          studentName: user.studentName || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ä‡∏∑‡πà‡∏≠",
	          advisorName: advisorName,
	          fileName: localStorage.getItem("uploadedFileName") || "petition.pdf"
	      };

	      try {
	          const response = await fetch("http://localhost:8081/api/petitions/upload", {
	              method: "POST",
	              headers: { "Content-Type": "application/json" },
	              body: JSON.stringify(petition)
	          });

	          if (response.ok) {
	              alert("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
	              localStorage.removeItem("uploadedFileName");
	              localStorage.removeItem("uploadedFilePreview");
	              window.location.href = "upload-success.html";
	          } else {
	              alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á");
	          }
	      } catch (err) {
	          console.error(err);
	          alert("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ");
	      }
	  });

	  // =============== ‡∏õ‡∏∏‡πà‡∏° "‡∏•‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á" ===============
	  document.getElementById("deleteBtn").addEventListener("click", () => {
	      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
	          localStorage.removeItem("uploadedFileName");
	          localStorage.removeItem("uploadedFilePreview");
	          window.location.href = "upload.html";
	      }
	  });
	</script>
    
</body>
</html>
